(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3bc05122"],{"064b":function(e,t,l){"use strict";var o=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-collapse-item",{attrs:{disabled:e.disabled,name:e.p+"-"+e.title}},[l("template",{slot:"title"},[l("div",{staticStyle:{width:"100%","font-size":"16px"},on:{click:e.modify}},[e._v(" "+e._s(e.title)+" ")])]),e._t("default")],2)],1)},s=[],a=l("4360");function i(e){a["a"].commit("modifyActiveCards",e)}var r={data(){return{p:""===this.prefix?this.$route.name:this.prefix}},props:{title:{type:String,default:""},disabled:{type:Boolean,default:!1},remember:{type:Boolean,default:!0},prefix:{type:String,default:""}},methods:{modify(){this.remember&&(""===this.prefix?i(this.$route.name+"-"+this.title):i(this.prefix+"-"+this.title))}}},n=r,d=(l("37b0"),l("2877")),c=Object(d["a"])(n,o,s,!1,null,"74180b3e",null);t["a"]=c.exports},"37b0":function(e,t,l){"use strict";var o=l("5f02"),s=l.n(o);s.a},"5f02":function(e,t,l){},"6c4f":function(e,t,l){"use strict";function o(e,t,l){return"undefined"===typeof t||""==t||/^\d+(ns|us|µs|ms|s|m|h)$/.test(t)?l():l(new Error("该字段必须以ns、us或µs、ms、s、m、h时间单位结尾，例如300ms"))}function s(e,t,l){return"undefined"===typeof t||""==t||/^[0-9]*$/.test(t)?l():l(new Error("该字段不能包含除数字以外的其他字符"))}l.d(t,"b",(function(){return o})),l.d(t,"a",(function(){return s}))},9641:function(e,t,l){"use strict";var o=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-card",{staticClass:"box-card item"},[l("el-collapse",{attrs:{value:e.activeList}},[e._t("default")],2)],1)],1)},s=[],a={computed:{activeList(){return this.$ls.get("active_cards")}}},i=a,r=l("2877"),n=Object(r["a"])(i,o,s,!1,null,"db2c75f6",null);t["a"]=n.exports},d368:function(e,t,l){"use strict";l.r(t);var o=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-form",{ref:"config",attrs:{"label-position":"top",model:e.config,rules:e.loggingRules,"status-icon":""}},[l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{staticClass:"container",attrs:{span:11}},[l("melody-card",[l("melody-card-item",{attrs:{title:"Logging"}},[l("el-form-item",{attrs:{label:"base logger"}},[l("el-switch",{on:{change:e.switchGologging},model:{value:e.enableGologging,callback:function(t){e.enableGologging=t},expression:"enableGologging"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" Melody提供了比较完善的基础logger。 ")])],1),e.enableGologging?[l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-form-item",{attrs:{label:"Level"}},[l("el-select",{attrs:{placeholder:"选择log级别"},model:{value:e.melody_gologging.level,callback:function(t){e.$set(e.melody_gologging,"level",t)},expression:"melody_gologging.level"}},e._l(e.logLevels,(function(e){return l("el-option",{key:e,attrs:{label:e,value:e}})})),1),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 日志打印的级别。 ")])],1)],1),l("el-col",{attrs:{span:11,offset:2}},[l("el-form-item",{attrs:{label:"Prefix"}},[l("el-input",{model:{value:e.melody_gologging.prefix,callback:function(t){e.$set(e.melody_gologging,"prefix",t)},expression:"melody_gologging.prefix"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 在日志行之前添加字符串前缀。 ")])],1)],1)],1),l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:e.enableCustomFormat?11:24}},[l("el-form-item",{attrs:{label:"Message Format"}},[l("el-select",{attrs:{placeholder:"选择日志格式"},model:{value:e.melody_gologging.format,callback:function(t){e.$set(e.melody_gologging,"format",t)},expression:"melody_gologging.format"}},e._l(e.formats,(function(e){return l("el-option",{key:e,attrs:{label:e,value:e}})})),1),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 日志记录、打印的格式。 ")])],1)],1),e.enableCustomFormat?l("el-col",{attrs:{span:11,offset:2}},[l("el-form-item",{attrs:{label:"Custom log format"}},[l("el-input",{attrs:{placeholder:"%{message}"},model:{value:e.melody_gologging.custom,callback:function(t){e.$set(e.melody_gologging,"custom",t)},expression:"melody_gologging.custom"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 可以使用一些表达式，更多表达式请参考"),l("a",{attrs:{target:"blank",href:"https://github.com/op/go-logging/blob/master/format.go#L156"}},[e._v("go-logging")])])],1)],1):e._e()],1),"custom"!=e.melody_gologging.format?l("el-row",[l("el-col",{attrs:{span:24}},[e._v(" 示例："),l("code",[e._v(e._s(e.exampleLog))])])],1):e._e(),l("el-form-item",{attrs:{label:"LogStash"}},[l("el-switch",{on:{change:e.switchLogStash},model:{value:e.enableLogStash,callback:function(t){e.enableLogStash=t},expression:"enableLogStash"}},[e._v("Enable")]),l("div",{staticStyle:{"font-size":"12px"}},[e._v("选择开启是否"),l("code",[e._v("LogStash")])])],1),l("el-form-item",{attrs:{label:"Writers"}},[l("el-checkbox",{model:{value:e.melody_gologging.syslog,callback:function(t){e.$set(e.melody_gologging,"syslog",t)},expression:"melody_gologging.syslog"}},[e._v("Syslog")]),l("el-checkbox",{model:{value:e.melody_gologging.stdout,callback:function(t){e.$set(e.melody_gologging,"stdout",t)},expression:"melody_gologging.stdout"}},[e._v("Stdout")]),l("div",{staticStyle:{"font-size":"12px"}},[l("code",[e._v("Syslog")]),e._v("将日志写入syslog系统。 "),l("code",[e._v("Stdout")]),e._v("将日志写入控制台。 ")])],1)]:e._e()],2)],1),l("melody-card",[l("melody-card-item",{attrs:{title:"Metrics"}},[l("el-form-item",{attrs:{label:"metrics integrate"}},[l("el-switch",{on:{change:e.switchMetrics},model:{value:e.enableMetrics,callback:function(t){e.enableMetrics=t},expression:"enableMetrics"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" metrics中间件收集整个melody的运行时数据，监听一个新端口，暴露"),l("code",[e._v("/__stats/")]),e._v("接口。 ")])],1),e.enableMetrics?[l("el-form-item",{attrs:{label:"Config"}},[l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-checkbox",{attrs:{label:"Disable '/__stats/'"},model:{value:e.melody_metrics.endpoint_disabled,callback:function(t){e.$set(e.melody_metrics,"endpoint_disabled",t)},expression:"melody_metrics.endpoint_disabled"}})],1),l("el-col",{attrs:{span:11}},[l("div",{staticStyle:{"font-size":"12px"}},[e._v(" metrics将不会暴露"),l("code",[e._v("/__stats/")]),e._v("接口，但是仍然会收集数据。 ")])])],1),l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-checkbox",{attrs:{label:"Disable proxy"},model:{value:e.melody_metrics.proxy_disabled,callback:function(t){e.$set(e.melody_metrics,"proxy_disabled",t)},expression:"melody_metrics.proxy_disabled"}})],1),l("el-col",{attrs:{span:11}},[l("div",{staticStyle:{"font-size":"12px"}},[e._v(" metrics将跳过代理层中的数据收集。 ")])])],1),l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-checkbox",{attrs:{label:"Disable router"},model:{value:e.melody_metrics.router_disabled,callback:function(t){e.$set(e.melody_metrics,"router_disabled",t)},expression:"melody_metrics.router_disabled"}})],1),l("el-col",{attrs:{span:11}},[l("div",{staticStyle:{"font-size":"12px"}},[e._v(" metrics将跳过路由层中的数据收集。 ")])])],1),l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-checkbox",{attrs:{label:"Disable backend layer metrics"},model:{value:e.melody_metrics.backend_disabled,callback:function(t){e.$set(e.melody_metrics,"backend_disabled",t)},expression:"melody_metrics.backend_disabled"}})],1),l("el-col",{attrs:{span:11}},[l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 与后端交互时，metrics将不会收集任何数据。 ")])])],1)],1),l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-form-item",{attrs:{label:"Listen Address"}},[l("el-input",{attrs:{placeholder:":8090"},model:{value:e.melody_metrics.listen_address,callback:function(t){e.$set(e.melody_metrics,"listen_address",t)},expression:"melody_metrics.listen_address"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 你可以通过"),l("code",[e._v(e._s(e.melody_metrics.listen_address)+"/__stats/")]),e._v("访问到metrics收集到的所有数据。 ")])],1)],1),l("el-col",{attrs:{span:11}},[l("el-form-item",{attrs:{label:"Collection time",prop:"extra_config.melody_metrics.collection_time"}},[l("el-input",{attrs:{placeholder:"60s",autocomplete:"off"},model:{value:e.melody_metrics.collection_time,callback:function(t){e.$set(e.melody_metrics,"collection_time",t)},expression:"melody_metrics.collection_time"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 收集的时间窗口。默认为60秒。 ")])],1)],1)],1)]:e._e()],2)],1),l("melody-card",[l("melody-card-item",{attrs:{title:"Opencensus"}},[l("div",[e._v("集成中~~")])])],1)],1),l("el-col",{staticClass:"container",attrs:{span:11}},[l("melody-card",[l("melody-card-item",{attrs:{title:"Gelf"}},[l("el-form-item",{attrs:{label:"gelf integrate"}},[l("el-switch",{on:{change:e.switchGelf},model:{value:e.enableGelf,callback:function(t){e.enableGelf=t},expression:"enableGelf"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" Melody与gelf集成，你可以设置Graylog服务的地址来作为输出。 ")])],1),e.enableGelf?[l("el-form-item",{attrs:{label:"Address"}},[l("el-input",{attrs:{placeholder:"gelf_server:12201"},model:{value:e.melody_gelf.addr,callback:function(t){e.$set(e.melody_gelf,"addr",t)},expression:"melody_gelf.addr"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" Graylog服务器（或任何接收gelf输入的服务）的地址（包括端口）。 ")])],1),l("el-form-item",{attrs:{label:"Enable TCP"}},[l("el-switch",{model:{value:e.melody_gelf.enable_tcp,callback:function(t){e.$set(e.melody_gelf,"enable_tcp",t)},expression:"melody_gelf.enable_tcp"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 默认情况下使用UDP，但您可以通过将此选项设置为true来启用TCP（不推荐，您的性能可能会受到影响）。 ")])],1)]:e._e()],2)],1),l("melody-card",[l("melody-card-item",{attrs:{title:"InfluxDB"}},[l("el-form-item",{attrs:{label:"write to influxDB"}},[l("el-switch",{on:{change:e.switchInfluxDB},model:{value:e.enableInflux,callback:function(t){e.enableInflux=t},expression:"enableInflux"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 允许你将"),l("code",[e._v("Metrics")]),e._v("采集到的数据写到"),l("code",[e._v("InfluxDB")]),e._v("中，以供Melody-Data去做数据分析。 ")])],1),e.enableInflux?[l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-form-item",{attrs:{label:"Address",prop:"extra_config.melody_influxdb.address"}},[l("el-input",{attrs:{placeholder:"influx server address"},model:{value:e.melody_influxdb.address,callback:function(t){e.$set(e.melody_influxdb,"address",t)},expression:"melody_influxdb.address"}}),l("div",{staticStyle:{"font-size":"12px"}},[l("code",[e._v("InfluxDB")]),e._v("地址及端口号，请注意务必以"),l("code",[e._v("http://")]),e._v("开头 ")])],1)],1),l("el-col",{attrs:{span:11,offset:3}},[l("el-form-item",{attrs:{label:"Database"}},[l("el-input",{attrs:{placeholder:"database name"},model:{value:e.melody_influxdb.db,callback:function(t){e.$set(e.melody_influxdb,"db",t)},expression:"melody_influxdb.db"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 指定数据库名，默认使用"),l("code",[e._v("melody_data")])])],1)],1)],1),l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-form-item",{attrs:{label:"Username"}},[l("el-input",{attrs:{placeholder:"username"},model:{value:e.melody_influxdb.username,callback:function(t){e.$set(e.melody_influxdb,"username",t)},expression:"melody_influxdb.username"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 访问"),l("code",[e._v("InfluxDB")]),e._v("的用户名 ")])],1)],1),l("el-col",{attrs:{span:11,offset:3}},[l("el-form-item",{attrs:{label:"Password"}},[l("el-input",{attrs:{placeholder:"password"},model:{value:e.melody_influxdb.password,callback:function(t){e.$set(e.melody_influxdb,"password",t)},expression:"melody_influxdb.password"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 访问"),l("code",[e._v("InfluxDB")]),e._v("的密码 ")])],1)],1)],1),l("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[l("el-col",{attrs:{span:11}},[l("el-form-item",{attrs:{label:"TTL",prop:"extra_config.melody_influxdb.ttl"}},[l("el-input",{attrs:{placeholder:"5s"},model:{value:e.melody_influxdb.ttl,callback:function(t){e.$set(e.melody_influxdb,"ttl",t)},expression:"melody_influxdb.ttl"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 将"),l("code",[e._v("Metrics")]),e._v("数据写到"),l("code",[e._v("InfluxDB")]),e._v("的时间窗口 ")])],1)],1),l("el-col",{attrs:{span:11,offset:3}},[l("el-form-item",{attrs:{label:"Timeout",prop:"extra_config.melody_influxdb.time_out"}},[l("el-input",{attrs:{placeholder:"5s"},model:{value:e.melody_influxdb.time_out,callback:function(t){e.$set(e.melody_influxdb,"time_out",t)},expression:"melody_influxdb.time_out"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 写数据的时延 ")])],1)],1)],1),l("el-form-item",{attrs:{label:"Buffer Size"}},[l("el-input",{attrs:{placeholder:"1024"},model:{value:e.melody_influxdb.buffer_size,callback:function(t){e.$set(e.melody_influxdb,"buffer_size",t)},expression:"melody_influxdb.buffer_size"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 某次发送失败时，会将失败的数据暂存到缓冲区中，设置为"),l("code",[e._v("0")]),e._v("时将不会暂存。 ")])],1),l("el-form-item",{attrs:{label:"Melody Data Server"}},[l("el-switch",{model:{value:e.melody_influxdb.data_server_enable,callback:function(t){e.$set(e.melody_influxdb,"data_server_enable",t)},expression:"melody_influxdb.data_server_enable"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 当你需要使用metrics采集到的数据时，你可以通过设置该值为"),l("code",[e._v("true")]),e._v("去开启"),l("code",[e._v("melody-data")]),e._v("，"),l("code",[e._v("melody-data")]),e._v("是一个单独的服务，拥有与influxDB交互的能力。 ")])],1),e.melody_influxdb.data_server_enable?[l("el-form-item",{attrs:{label:"Melody Data Server Address"}},[l("el-input",{attrs:{placeholder:"melody data server address"},model:{value:e.melody_influxdb.data_server_port,callback:function(t){e.$set(e.melody_influxdb,"data_server_port",t)},expression:"melody_influxdb.data_server_port"}}),l("div",{staticStyle:{"font-size":"12px"}},[l("code",[e._v("melody-data")]),e._v("监听的地址，默认使用"),l("code",[e._v("8001")])])],1),l("el-form-item",{attrs:{label:"Mehtod Config"}},[l("el-checkbox",{attrs:{label:"Enable query"},model:{value:e.melody_influxdb.data_server_query_enable,callback:function(t){e.$set(e.melody_influxdb,"data_server_query_enable",t)},expression:"melody_influxdb.data_server_query_enable"}}),l("div",{staticStyle:{"font-size":"12px"}},[e._v(" 是否开放接口method:"),l("code",[e._v("POST")]),e._v(" url:"),l("code",[e._v("/query ")]),e._v(" request body: "),l("code",[e._v('"command": "查询语句" ，"database": "数据库名"， "precision": "精度，默认rfc3339, 可选h, m, s, ms, u or ns"')])])],1)]:e._e()]:e._e()],2)],1)],1)],1)],1)],1)},s=[],a=l("9641"),i=l("064b"),r=l("6c4f"),n={name:"logging",components:{MelodyCard:a["a"],MelodyCardItem:i["a"]},computed:{enableCustomFormat(){return"custom"==this.melody_gologging.format},exampleLog(){return this.exampleLogs["default"==this.melody_gologging.format?0:1]}},data(){let e=this.$store.getters.serviceConfig;return{config:e,logLevels:["DEBUG","INFO","WARNING","ERROR","CRITICAL"],formats:["default","custom","logstash"],exampleLogs:["[MELODY]2020/03/20 - 14:12:02.770 ▶ DEBUG [name: some message]",'{"@timestamp":"2000-03-20T13:24:24.348+00:00", "@version": 1, "level": "DEBUG", "message": "[name: some message]", "module": "MELODY"}'],loggingRules:{extra_config:{melody_metrics:{collection_time:[{validator:r["b"],trigger:"blur"}]},melody_influxdb:{address:[{required:!0,message:"InfluxDB的地址是必须的"}],ttl:[{required:!0,message:"数据写入的时间窗口是必须的",trigger:"blur"},{validator:r["b"],trigger:"blur"}],time_out:[{required:!0,message:"数据写入的时延是必须的",trigger:"blur"},{validator:r["b"],trigger:"blur"}]}}},enableGologging:void 0!==e.extra_config.melody_gologging,melody_gologging:void 0==e.extra_config.melody_gologging?{prefix:"[MELODY]",level:"DEBUG",format:"default"}:e.extra_config.melody_gologging,enableLogStash:void 0!==e.extra_config.melody_logstash,melody_logstash:void 0==e.extra_config.melody_logstash?{enable:!0}:e.extra_config.melody_logstash,enableGelf:void 0!==e.extra_config.melody_gelf,melody_gelf:void 0==e.extra_config.melody_gelf?{addr:"",enable_tcp:!1}:e.extra_config.melody_gelf,enableMetrics:void 0!==e.extra_config.melody_metrics,melody_metrics:void 0==e.extra_config.melody_metrics?{endpoint_disabled:!1,proxy_disabled:!1,router_disabled:!1,backend_disabled:!1,collection_time:"",listen_address:":8090"}:e.extra_config.melody_metrics,enableInflux:void 0!==e.extra_config.melody_influxdb,melody_influxdb:void 0==e.extra_config.melody_influxdb?{address:"http://127.0.0.1:8086",username:"",password:"",db:"melody_data",buffer_size:1024,ttl:"5s",time_out:"5s",data_server_enable:!1,data_server_port:":8001",data_server_query_enable:!0}:e.extra_config.melody_influxdb}},methods:{switchGologging(e){e?this.$store.commit("setExtraConfig",{name:"melody_gologging",config:this.melody_gologging}):(this.$store.commit("removeExtraConfig",{name:"melody_gologging"}),this.$store.commit("removeExtraConfig",{name:"melody_logstash"}))},switchLogStash(e){e?(this.melody_gologging.format="logstash",this.$store.commit("setExtraConfig",{name:"melody_logstash",config:this.melody_logstash})):this.$store.commit("removeExtraConfig",{name:"melody_logstash"})},switchGelf(e){e?this.$store.commit("setExtraConfig",{name:"melody_gelf",config:this.melody_gelf}):this.$store.commit("removeExtraConfig",{name:"melody_gelf"})},switchMetrics(e){e?this.$store.commit("setExtraConfig",{name:"melody_metrics",config:this.melody_metrics}):this.$store.commit("removeExtraConfig",{name:"melody_metrics"})},switchInfluxDB(e){e?this.$store.commit("setExtraConfig",{name:"melody_influxdb",config:this.melody_influxdb}):this.$store.commit("removeExtraConfig",{name:"melody_influxdb"})}},watch:{config:{handler:function(){this.$refs.config.validate().catch(e=>{console.log(e)}),this.$store.commit("updateServiceConfig",this.config)},deep:!0},melody_gologging:{handler:function(){this.$store.commit("setExtraConfig",{name:"melody_gologging",config:this.melody_gologging})},deep:!0},melody_gelf:{handler:function(){this.$store.commit("setExtraConfig",{name:"melody_gelf",config:this.melody_gelf})},deep:!0},melody_metrics:{handler:function(){this.$refs.config.validate(e=>{e&&this.$store.commit("setExtraConfig",{name:"melody_metrics",config:this.melody_metrics})})},deep:!0},melody_influxdb:{handler:function(){this.$refs.config.validate(e=>{e&&this.$store.commit("setExtraConfig",{name:"melody_influxdb",config:this.melody_influxdb})})},deep:!0}}},d=n,c=l("2877"),m=Object(c["a"])(d,o,s,!1,null,null,null);t["default"]=m.exports}}]);
//# sourceMappingURL=chunk-3bc05122.2d873bec.js.map