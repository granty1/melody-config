{"version":3,"sources":["webpack:///./src/views/import/index.vue?cf28","webpack:///./src/views/import/index.vue?0c89","webpack:///src/views/import/index.vue","webpack:///./src/views/import/index.vue?e534","webpack:///./src/views/import/index.vue","webpack:///./src/utils/config/EndpointConfig.js","webpack:///./src/utils/config/Backend.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","slot","_v","melodyJSON","loadJsonFile","staticRenderFns","name","methods","file","reader","FileReader","readAsText","raw","onload","$ls","get","$confirm","then","JSON","parse","result","parseHostInJSON","copyEndCfg","$store","commit","endCfg","endpoints","endpointTemp","EndpointConfig","backendTemp","Backend","i","endpoint","setExtra","backCfg","backends","m","backend","j","undefined","extra_config","sdHost","v","endCfgitem","ev","backendcfgs","bv","hosti","host","temp","sd","indexOf","push","component","constructor","method","output_encoding","melody_ratelimit_router","melody_proxy","melody_jose_validator","melody_jose_signer","melody_alert","url_pattern","melody_ratelimit_proxy","melody_http","encoding","blacklist","whitelist","mapping","is_collection","disable_host_sanitize"],"mappings":"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","file":"js/chunk-0a73e32c.f527b674.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-row',{staticClass:\"row-bg\",attrs:{\"type\":\"flex\",\"justify\":\"space-around\"}},[_c('el-col',{staticClass:\"container\",attrs:{\"span\":11}},[_c('el-card',{staticClass:\"box-card item\"},[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"预览melody.json\")])]),_c('json-viewer',{attrs:{\"value\":_vm.melodyJSON,\"expand-depth\":2,\"theme\":\"my-awesome-json-theme\"}})],1)],1),_c('el-col',{staticClass:\"container\",attrs:{\"span\":11}},[_c('el-card',{staticClass:\"box-card item\"},[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"导入melody.json\")])]),_c('div',{staticClass:\"center\"},[_c('el-upload',{attrs:{\"drag\":\"\",\"multiple\":false,\"show-file-list\":false,\"auto-upload\":false,\"accept\":\".json\",\"action\":\"\",\"on-change\":_vm.loadJsonFile}},[_c('i',{staticClass:\"el-icon-upload\"}),_c('div',{staticClass:\"el-upload__text\"},[_vm._v(\"将文件拖到此处，或\"),_c('em',[_vm._v(\"点击上传\")])])])],1)])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <el-row type=\"flex\" class=\"row-bg\" justify=\"space-around\">\n      <!-- 预览 -->\n      <el-col :span=\"11\" class=\"container\">\n        <el-card class=\"box-card item\">\n          <div slot=\"header\" class=\"clearfix\">\n            <span>预览melody.json</span>\n          </div>\n          <json-viewer\n            :value=\"melodyJSON\"\n            :expand-depth=\"2\"\n            theme=\"my-awesome-json-theme\"\n          ></json-viewer>\n        </el-card>\n      </el-col>\n      <!-- 导入 -->\n      <el-col :span=\"11\" class=\"container\">\n        <el-card class=\"box-card item\">\n          <div slot=\"header\" class=\"clearfix\">\n            <span>导入melody.json</span>\n          </div>\n          <div class=\"center\">\n            <el-upload\n              drag\n              :multiple=\"false\"\n              :show-file-list=\"false\"\n              :auto-upload=\"false\"\n              accept=\".json\"\n              action=\"\"\n              :on-change=\"loadJsonFile\"\n            >\n              <i class=\"el-icon-upload\"></i>\n              <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\n            </el-upload>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport EndpointConfig from '@/utils/config/EndpointConfig.js'\nimport Backend from '@/utils/config/Backend.js'\nexport default {\n  name: 'Import',\n  data() {\n    return {\n      melodyJSON: '',\n    }\n  },\n  methods: {\n    loadJsonFile(file) {\n      const reader = new FileReader()\n      reader.readAsText(file.raw)\n      reader.onload = () => {\n        //当读取完成后回调这个函数,然后此时文件的内容存储到了result中,直接操作即可\n        if (this.$ls.get('config')) {\n          this.$confirm('导入会覆盖已存在的配置，是否继续？').then(() => {\n            this.melodyJSON = JSON.parse(reader.result)\n            this.parseHostInJSON(this.melodyJSON)\n            this.copyEndCfg(this.melodyJSON)\n            this.$store.commit('updateServiceConfig', this.melodyJSON)\n          })\n        } else {\n          this.melodyJSON = JSON.parse(reader.result)\n          this.$store.commit('updateServiceConfig', this.melodyJSON)\n        }\n      }\n    },\n    copyEndCfg(melodyJSON) {\n      let endCfg = melodyJSON.endpoints\n      let endpointTemp = new EndpointConfig()\n      let backendTemp = new Backend()\n      for (let i in endCfg) {\n        let endpoint = endCfg[i]\n        this.setExtra(endpointTemp, endpoint)\n        let backCfg = endpoint.backends\n        for (let m in backCfg) {\n          let backend = backCfg[m]\n          this.setExtra(backendTemp, backend)\n        }\n      }\n    },\n    setExtra(endpointTemp, endpoint) {\n      for (let j in endpointTemp) {\n        if (j === 'extra_config') {\n          if (endpoint['extra_config'] === undefined) {\n            endpoint['extra_config'] = {}\n          }\n          for (let m in endpointTemp[j]) {\n            let extra_config = endpointTemp[j][m]\n            if (endpoint['extra_config'][m] === undefined) {\n              endpoint['extra_config'][m] = extra_config\n            }\n          }\n        } else {\n          if (endpoint[j] === undefined) {\n            endpoint[j] = endpointTemp[j]\n          }\n        }\n      }\n    },\n    parseHostInJSON(melodyJSON) {\n      let endCfg = melodyJSON.endpoints\n      let sdHost = []\n      for (let v in endCfg) {\n        let endCfgitem = endCfg[v]\n        for (let ev in endCfgitem) {\n          if (ev === 'backends') {\n            let backendcfgs = endCfgitem[ev]\n            for (let bv in backendcfgs) {\n              let backCfg = backendcfgs[bv]\n              for (let hosti in backCfg.host) {\n                let temp = ''\n                if (backCfg.sd === undefined || backCfg.sd === '') {\n                  temp = 'static - ' + backCfg.host[hosti]\n                  backCfg['sd'] = 'static'\n                } else {\n                  temp = backCfg.sd + ' - ' + backCfg.host[hosti]\n                }\n                if (sdHost.indexOf(temp) === -1) {\n                  sdHost.push(temp)\n                }\n              }\n            }\n          }\n        }\n      }\n\n      this.$store.commit('setAvailableHosts', sdHost)\n    },\n  },\n  mounted() {\n    if (this.$ls.get('config')) {\n      this.melodyJSON = this.$ls.get('config')\n    } else {\n      this.melodyJSON = '暂无配置'\n    }\n  },\n}\n</script>\n\n<style lang=\"scss\">\n.center {\n  display: flex;\n  justify-content: center;\n  justify-items: center;\n}\n// values are default one from jv-light template\n.my-awesome-json-theme {\n  background: #fff;\n  white-space: nowrap;\n  color: #525252;\n  font-size: 16px;\n  font-family: Consolas, Menlo, Courier, monospace;\n\n  .jv-ellipsis {\n    color: #999;\n    background-color: #eee;\n    display: inline-block;\n    line-height: 0.9;\n    font-size: 0.9em;\n    padding: 0px 4px 2px 4px;\n    border-radius: 3px;\n    vertical-align: 2px;\n    cursor: pointer;\n    user-select: none;\n  }\n  .jv-button {\n    color: #49b3ff;\n  }\n  .jv-key {\n    color: #111111;\n  }\n  .jv-item {\n    &.jv-array {\n      color: #111111;\n    }\n    &.jv-boolean {\n      color: #fc1e70;\n    }\n    &.jv-function {\n      color: #067bca;\n    }\n    &.jv-number {\n      color: #fc1e70;\n    }\n    &.jv-object {\n      color: #111111;\n    }\n    &.jv-undefined {\n      color: #e08331;\n    }\n    &.jv-string {\n      color: #42b983;\n      word-break: break-word;\n      white-space: normal;\n    }\n  }\n  .jv-code {\n    .jv-toggle {\n      &:before {\n        padding: 0px 2px;\n        border-radius: 2px;\n      }\n      &:hover {\n        &:before {\n          background: #eee;\n        }\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=3e31164f&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","class EndpointConfig {\n  constructor() {\n    this.endpoint = '/new-endpoint'\n    this.method = 'GET'\n    this.output_encoding = 'JSON'\n    this.extra_config = {\n      melody_ratelimit_router: {},\n      melody_proxy: {},\n      melody_jose_validator: {},\n      melody_jose_signer: {},\n      melody_alert: {},\n    }\n    this.backends = []\n  }\n}\n\nexport default EndpointConfig\n","class Backend {\n  constructor() {\n    this.url_pattern = '/new-point'\n    this.method = 'GET'\n    this.extra_config = {\n      melody_ratelimit_proxy: {},\n      melody_http: {},\n    }\n    this.host = []\n    this.encoding = 'json'\n    this.blacklist = []\n    this.whitelist = []\n    this.mapping = {}\n    this.is_collection = false\n    this.disable_host_sanitize = false\n  }\n}\n\nexport default Backend\n"],"sourceRoot":""}